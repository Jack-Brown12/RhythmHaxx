import"../chunks/DsnmJJEf.js";import{i as pt}from"../chunks/CbCRK_Jy.js";import{ah as V,V as I,a0 as E,_,$ as k,X as U,a1 as W,Y as M,U as G,ab as K,ai as gt,aj as rt,Z as H,m as y,ac as R,A as L,W as N,ae as X,x as q}from"../chunks/CAENWPe6.js";import{i as B}from"../chunks/CP4xJXuJ.js";import{b as F}from"../chunks/BopjTtzy.js";import{s as ft,t as at}from"../chunks/wm4-jcPJ.js";const mt=""+new URL("../assets/example.Cm2TaKrs.jpg",import.meta.url).href;var vt=I('<div class="absolute bottom-4 left-0 w-full px-3"><button class="w-full rounded bg-blue-500 px-4 py-2 text-white hover:cursor-pointer hover:bg-blue-600 disabled:cursor-not-allowed disabled:bg-gray-400"> </button></div>'),ht=I(`<div class="relative h-screen w-64 bg-gray-600 px-2 text-white"><h1 class="pt-2 pb-1 text-center text-4xl font-bold">Draw2Route</h1> <p>Want to spice your run up? Have a cool strava profile? Draw a shape and we'll try to draw it
		using streets! <br/> <span class="text-xs font-extralight italic">(Accurcy may vary based on location and street availability)</span></p> <img alt="Example route drawn on a map" class="my-4 rounded border border-white"/> <hr class="my-2 border-white"/> <p> </p> <!></div>`);function Q(a,o){var t=ht(),e=E(_(t),4),n=E(e,4),u=_(n,!0);k(n);var i=E(n,2);{var g=s=>{var l=vt(),r=_(l);r.__click=function(...d){o.onButtonClick?.apply(this,d)};var c=_(r,!0);k(r),k(l),U(()=>{r.disabled=!o.buttonEnabled,W(c,o.buttonText)}),M(s,l)};B(i,s=>{o.buttonText!=""&&s(g)})}k(t),U(()=>{ft(e,"src",mt),W(u,o.description)}),M(a,t)}V(["click"]);const Z=(a,o)=>{if(!a||!o)return;const t=window.devicePixelRatio||1,e=o.getBoundingClientRect();o.width=e.width*t,o.height=e.height*t,a.setTransform(t,0,0,t,0,0)};var bt=I('<div class="flex flex-row"><!> <canvas class="h-screen w-full"></canvas></div>');function wt(a,o){G(o,!0);let t,e=null;const n=10;let u=!1,i=R(!1),g=[],s=[],l=0;const r=()=>{l||(l=requestAnimationFrame(c))},c=()=>{if(l=0,!e||s.length===0)return;e.beginPath();let[f,h]=g.at(-1)??s.shift();for(g.length===0&&g.push([f,h]),e.moveTo(f,h);s.length;){const[b,D]=s.shift();Math.hypot(b-f,D-h)>=n&&(e.lineTo(b,D),g.push([b,D]),f=b,h=D)}e.stroke()},d=f=>{y(i)&&(s=[],g=[],e?.clearRect(0,0,t.width,t.height),L(i,!1)),u=!0;const h=f.clientX-t.offsetLeft,b=f.clientY-t.offsetTop;s.push([h,b]),r()},p=f=>{if(!u||y(i))return;const h=f.clientX-t.offsetLeft,b=f.clientY-t.offsetTop;s.push([h,b]),r()},m=f=>{g.length>=10&&L(i,!0)};K(()=>{e=t.getContext("2d"),!(typeof window>"u"||!e)&&(Z(e,t),e.strokeStyle="black",e.lineWidth=2,e.lineCap="round",e.lineJoin="round",window.addEventListener("pointerup",m),window.addEventListener("resize",()=>Z(e,t)))}),gt(()=>{typeof window>"u"||(window.removeEventListener("pointerup",m),window.removeEventListener("resize",()=>Z(e,t)),l&&cancelAnimationFrame(l))});var v=bt(),x=_(v);Q(x,{onButtonClick:()=>o.nextStage(g),description:`To get started, click and drag a continuous route on the white canvas. Don't release until you're
		done! If you mess up, just click again to redraw on a fresh canvas.`,buttonText:"Insert onto the globe!",get buttonEnabled(){return y(i)}});var P=E(x,2);P.__pointerdown=d,P.__pointermove=p,F(P,f=>t=f,()=>t),k(v),rt("pointerleave",P,m),M(a,v),H()}V(["pointerdown","pointermove"]);function yt(a,o){a.src=o}const xt=a=>{var o,t,e,n="The Google Maps JavaScript API",u="google",i="importLibrary",g="__ib__",s=document,l=window,r=l[u]||(l[u]={}),c=r.maps||(r.maps={}),d=new Set,p=new URLSearchParams,m=()=>o||(o=new Promise(async(v,x)=>{await(t=s.createElement("script")),p.set("libraries",[...d]+"");for(e in a)p.set(e.replace(/[A-Z]/g,P=>"_"+P[0].toLowerCase()),a[e]);p.set("callback",u+".maps."+g),yt(t,"https://maps.googleapis.com/maps/api/js?"+p),c[g]=v,t.onerror=()=>o=x(Error(n+" could not load.")),t.nonce=s.querySelector("script[nonce]")?.nonce||"",s.head.append(t)}));c[i]?console.warn(n+" only loads once. Ignoring:",a):c[i]=(v,...x)=>d.add(v)&&m().then(()=>c[i](v,...x))},_t=a=>`The setOptions() function should only be called once. The options passed to the additional call (${JSON.stringify(a)}) will be ignored.`,kt=a=>`The google.maps.importLibrary() function is already defined, and @googlemaps/js-api-loader will use the existing function instead of overwriting it. The options passed to setOptions (${JSON.stringify(a)}) will be ignored.`,Pt=()=>{},Et=()=>{};let ot=!1;function Tt(a){if(ot){Pt(_t(a));return}St(a),ot=!0}async function A(a){if(!window?.google?.maps?.importLibrary)throw new Error("google.maps.importLibrary is not installed.");return await google.maps.importLibrary(a)}function St(a){const o=!!window.google?.maps?.importLibrary;o&&Et(kt(a)),o||xt(a)}const Mt=(a,o,t)=>{if(!a||a.length===0)return[];const e=[];let n=o;e.push(n);for(let u=1;u<a.length;u++){const[i,g]=a[u-1],[s,l]=a[u],r=s-i,c=l-g,d=Math.hypot(r,c);if(d===0){e.push(n);continue}const m=d/t*1e3,v=(Math.atan2(r,-c)*180/Math.PI+360)%360,x=google.maps.geometry.spherical.computeOffset(n,m,v);n={lat:x.lat(),lng:x.lng()},e.push(n)}return e},nt=a=>{if(!a||a.length<2)return 0;const o=a.map(e=>new google.maps.LatLng(e.lat,e.lng));return google.maps.geometry.spherical.computeLength(o)/1e3},Lt=(a,o)=>{if(!a||a.length===0)return[];if(a.length===1)return[a[0]];const[t,e]=a[0],n=o*Math.PI/180,u=Math.cos(n),i=Math.sin(n);return a.map(([g,s],l)=>{if(l===0)return[g,s];const r=g-t,c=s-e,d=r*u-c*i,p=r*i+c*u;return[t+d,e+p]})};var Ot=I('<div class="absolute top-1/2 left-1/2 z-10 -translate-x-1/2 -translate-y-1/2 rounded-2xl border border-gray-300 bg-white/80 px-6 py-4 shadow-lg backdrop-blur-md">Please enter a starting location to see your route on the map.</div>'),It=I('<div class="absolute bottom-6 left-1/2 z-10 flex -translate-x-1/2 flex-col items-center space-y-3 rounded-2xl border border-gray-300 bg-white/80 px-4 py-3 shadow-lg backdrop-blur-md"><div class="flex w-full flex-col items-center"><label for="rotation-slider" class="mb-1 text-xs font-medium text-gray-700">Rotation (Â°)</label> <input id="rotation-slider" type="range" min="-180" max="180" step="1" value="0" class="h-2 w-64 cursor-pointer appearance-none rounded-lg bg-gray-200 accent-black"/></div> <div class="flex w-full flex-col items-center"><label for="scale-slider" class="mb-1 text-xs font-medium text-gray-700">Scale (pixels/km)</label> <input id="scale-slider" type="range" min="1" max="40" step="0.5" value="20" class="h-2 w-64 cursor-pointer appearance-none rounded-lg bg-gray-200 accent-black"/></div></div>'),Dt=I('<div class="absolute top-3 right-3 rounded-xl border border-gray-300 bg-white/80 px-4 py-2 text-sm font-semibold text-gray-800 shadow-lg backdrop-blur-md"> </div>'),At=I('<div class="flex flex-row"><!> <div class="relative h-screen w-full"><form><div class="absolute top-4 left-1/2 z-10 w-96 -translate-x-1/2"><input type="text" placeholder="Enter starting location..." class="w-full rounded-lg border border-gray-300 bg-white/90 px-4 py-2 shadow-lg outline-none focus:ring-2 focus:ring-blue-500"/></div></form> <!> <div class="h-full w-full"></div></div></div> <!>',1);function Ct(a,o){G(o,!0);let t,e,n,u,i,g=1e3/20,s=0,l,r=null,c=null,d=R(!1),p=R(0),m=R("Mapify!");K(async()=>{if(!window||!n)return;const{Map:w}=await A("maps"),T=await A("places");await A("geometry");const{AdvancedMarkerElement:O}=await A("marker");t=new w(n,{center:{lat:43.4772382,lng:-80.5520715},mapId:"main",zoom:13,disableDefaultUI:!0,gestureHandling:"none",zoomControl:!0,keyboardShortcuts:!1,disableDoubleClickZoom:!0}),i=()=>{if(!l||!o.points||o.points.length===0)return;const C={lat:l.lat(),lng:l.lng()},S=Mt(Lt(o.points,s),C,g);L(p,nt(S),!0),r&&r.setMap(null),r=new google.maps.Polyline({path:S,map:t,geodesic:!0,strokeColor:"black",strokeOpacity:1,strokeWeight:3});const J=S[0],j=S[S.length-1],z=`
      					width: 12px;
      					height: 12px;
      					background-color: green;
      					border-radius: 50%;
      					border: 2px solid white;
    				`;new O({position:J,map:t,content:Object.assign(document.createElement("div"),{style:z})}),c&&(c.map=null),c=new O({position:j,map:t,content:Object.assign(document.createElement("div"),{style:z})});const Y=S.reduce((tt,et)=>({lat:tt.lat+et.lat,lng:tt.lng+et.lng}),{lat:0,lng:0});Y.lat/=S.length,Y.lng/=S.length,t.panTo(Y)},e=new T.Autocomplete(u,{fields:["place_id","geometry","name","formatted_address"],types:["geocode"]}),e.addListener("place_changed",()=>{l=e.getPlace()?.geometry?.location,l&&(L(d,!0),i())})});const v=w=>{w.preventDefault()};var x=At(),P=N(x),f=_(P);Q(f,{onButtonClick:()=>{L(m,"Mapping..."),o.nextStage(r)},description:"Time to place your masterpiece on the globe! Start by entering the address you want to start from. Afterwards, use the two sliders to adjust the size and rotation of your drawing.",get buttonText(){return y(m)},get buttonEnabled(){return y(d)}});var h=E(f,2),b=_(h),D=_(b),it=_(D);F(it,w=>u=w,()=>u),k(D),k(b);var $=E(b,2);{var st=w=>{var T=Ot();M(w,T)},lt=w=>{var T=It(),O=_(T),C=E(_(O),2);C.__input=j=>{s=+j.target.value,i()},k(O);var S=E(O,2),J=E(_(S),2);J.__input=j=>{g=1e3/+j.target.value,i()},k(S),k(T),M(w,T)};B($,w=>{y(d)?w(lt,!1):w(st)})}var ct=E($,2);F(ct,w=>n=w,()=>n),k(h),k(P);var dt=E(P,2);{var ut=w=>{var T=Dt(),O=_(T);k(T),U(C=>W(O,`Estimated Distance: ${C??""} km`),[()=>y(p).toFixed(2)]),M(w,T)};B(dt,w=>{y(d)&&w(ut)})}rt("submit",b,v),M(a,x),H()}V(["input"]);var Bt=I('<div class="flex flex-row"><!> <div class="relative h-screen w-full"><div class="h-full w-full"></div> <div class="absolute top-3 right-3 rounded-xl border border-gray-300 bg-white/80 px-4 py-2 text-sm font-semibold text-gray-800 shadow-lg backdrop-blur-md"> </div></div></div>');function jt(a,o){G(o,!0);let t,e,n=null,u=R(0);K(async()=>{if(!window||!e)return;const{Map:d}=await A("maps");await A("geometry");const{AdvancedMarkerElement:p}=await A("marker");if(t=new d(e,{center:{lat:43.4772382,lng:-80.5520715},mapId:"main",zoom:13,disableDefaultUI:!0}),!o.mapifiedPath)return;const m=o.mapifiedPath.map(([h,b])=>({lat:h,lng:b}));L(u,nt(m),!0),new google.maps.Polyline({path:m,map:t,geodesic:!0,strokeColor:"black",strokeOpacity:1,strokeWeight:3});const v=m[0],x=m[m.length-1],P=`
						width: 12px;
						height: 12px;
						background-color: red;
						border-radius: 50%;
						border: 2px solid white;
					`;new p({position:v,map:t,content:Object.assign(document.createElement("div"),{style:P})}),n&&(n.map=null),n=new p({position:x,map:t,content:Object.assign(document.createElement("div"),{style:P})});const f=m.reduce((h,b)=>({lat:h.lat+b.lat,lng:h.lng+b.lng}),{lat:0,lng:0});f.lat/=m.length,f.lng/=m.length,t.panTo(f)});var i=Bt(),g=_(i);Q(g,{onButtonClick:()=>{},description:"Here is your mapified path! If its not what you expected, feel free to go back and adjust your address or rotation.",buttonText:"",buttonEnabled:!1});var s=E(g,2),l=_(s);F(l,d=>e=d,()=>e);var r=E(l,2),c=_(r);k(r),k(s),k(i),U(d=>W(c,`Distance: ${d??""} km`),[()=>y(u).toFixed(2)]),M(a,i),H()}function Gt(a,o){G(o,!1);let t=q(0),e=q(null),n=q();K(async()=>{try{const r=await fetch("/api/config");if(!r.ok)throw new Error("Failed to fetch config");const c=await r.json();Tt({key:c.mapsApiKey})}catch(r){at.push(`Error loading config: ${r}`,{theme:{"--toastBackground":"red","--toastColor":"white","--toastBarBackground":"white"}})}});const u=r=>{if(y(t)===0)L(e,r),L(t,y(t)+1);else if(y(t)===1){const c=r.getPath(),d=[];c.forEach(p=>{d.push([p.lat(),p.lng()])}),fetch("/api/mapify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({points:d})}).then(p=>p.json()).then(p=>{L(n,p.points),L(t,y(t)+1)}).catch(p=>{at.push(`Error: ${p}`,{theme:{"--toastBackground":"red","--toastColor":"white","--toastBarBackground":"white"}})})}};pt();var i=X(),g=N(i);{var s=r=>{wt(r,{nextStage:u})},l=r=>{var c=X(),d=N(c);{var p=v=>{Ct(v,{get points(){return y(e)},nextStage:u})},m=v=>{var x=X(),P=N(x);{var f=h=>{jt(h,{get mapifiedPath(){return y(n)}})};B(P,h=>{y(t)===2&&h(f)},!0)}M(v,x)};B(d,v=>{y(t)===1?v(p):v(m,!1)},!0)}M(r,c)};B(g,r=>{y(t)===0?r(s):r(l,!1)})}M(a,i),H()}export{Gt as component};
